<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head th:replace="~{admin/layout :: header}"></head>
  <body>
    <div th:replace="~{admin/layout :: sidebar}"></div>

    <div class="content">
      <div class="container-fluid">
        <!-- Page Header -->
        <div class="page-header mb-4">
          <h2><i class="fas fa-tachometer-alt me-2"></i>Dashboard</h2>
          <p class="text-muted mb-0">Tổng quan hệ thống UniActivity 4.0</p>
        </div>

        <!-- Main Statistics Cards -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card stat-card text-white bg-primary">
              <div class="card-header">Tổng số Khoa</div>
              <div class="card-body">
                <h5 class="card-title display-4" th:text="${totalFaculties != null ? totalFaculties : 0}">0</h5>
                <i class="fas fa-university stat-icon"></i>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stat-card text-white bg-success">
              <div class="card-header">Tổng số Lớp</div>
              <div class="card-body">
                <h5 class="card-title display-4" th:text="${totalClasses != null ? totalClasses : 0}">0</h5>
                <i class="fas fa-chalkboard-teacher stat-icon"></i>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stat-card text-white bg-warning">
              <div class="card-header">Tổng số Sinh viên</div>
              <div class="card-body">
                <h5 class="card-title display-4" th:text="${totalStudents != null ? totalStudents : 0}">0</h5>
                <i class="fas fa-user-graduate stat-icon"></i>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card stat-card text-white bg-info">
              <div class="card-header">Hoạt động đang mở</div>
              <div class="card-body">
                <h5 class="card-title display-4" th:text="${activeActivities != null ? activeActivities : 0}">0</h5>
                <i class="fas fa-calendar-check stat-icon"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Faculty & Academic Year Breakdown -->
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-header">
                <i class="fas fa-university me-2"></i>Danh sách Khoa
              </div>
              <div class="card-body p-0">
                <table class="table table-sm mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Khoa</th>
                      <th>Mã</th>
                      <th>Trạng thái</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="f : ${faculties}">
                      <td th:text="${f.name}">Khoa CNTT</td>
                      <td><span class="badge bg-secondary" th:text="${f.code}">CNTT</span></td>
                      <td>
                        <span th:if="${f.status == 'ACTIVE'}" class="badge bg-success">Hoạt động</span>
                        <span th:if="${f.status != 'ACTIVE'}" class="badge bg-danger">Ngừng</span>
                      </td>
                    </tr>
                    <tr th:if="${faculties == null or #lists.isEmpty(faculties)}">
                      <td colspan="3" class="text-center text-muted py-3">Chưa có dữ liệu</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card h-100">
              <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-calendar-alt me-2"></i>Hoạt động gần đây</span>
                <a th:href="@{/admin/activities}" class="btn btn-sm btn-outline-primary">Xem tất cả</a>
              </div>
              <div class="card-body p-0">
                <table class="table table-sm mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Tên hoạt động</th>
                      <th>Phạm vi</th>
                      <th>Trạng thái</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="act : ${recentActivities}">
                      <td th:text="${act.name}">Hoạt động ABC</td>
                      <td>
                        <span th:if="${act.scope == 'SCHOOL'}" class="badge bg-primary">Toàn trường</span>
                        <span th:if="${act.scope == 'FACULTY'}" class="badge bg-info">Theo khoa</span>
                      </td>
                      <td>
                        <span th:if="${act.status == 'DRAFT'}" class="badge bg-secondary">Nháp</span>
                        <span th:if="${act.status == 'OPEN'}" class="badge bg-success">Mở đăng ký</span>
                        <span th:if="${act.status == 'FINISHED'}" class="badge bg-dark">Kết thúc</span>
                      </td>
                    </tr>
                    <tr th:if="${recentActivities == null or #lists.isEmpty(recentActivities)}">
                      <td colspan="3" class="text-center text-muted py-3">Chưa có hoạt động nào</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Classes Breakdown by Faculty -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="fas fa-users me-2"></i>Danh sách Lớp (với Khoa và Khóa)</span>
                <a th:href="@{/admin/classes}" class="btn btn-sm btn-outline-primary">Quản lý lớp</a>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                  <table class="table table-sm table-hover mb-0">
                    <thead class="table-light sticky-top">
                      <tr>
                        <th>Mã lớp</th>
                        <th>Tên lớp</th>
                        <th>Khoa</th>
                        <th>Khóa</th>
                        <th>Join Code</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr th:each="c : ${classes}">
                        <td><span class="badge bg-secondary" th:text="${c.code}">CNTT-K45A</span></td>
                        <td th:text="${c.name}">Lớp CNTT K45A</td>
                        <td>
                          <span class="badge bg-primary" th:text="${c.facultyName != null ? c.facultyName : 'Chưa gán'}">Khoa</span>
                        </td>
                        <td>
                          <span class="badge bg-info" th:text="${c.academicYearCode != null ? c.academicYearCode : 'Chưa gán'}">Khóa</span>
                        </td>
                        <td><code th:text="${c.joinCode}">ABC123</code></td>
                      </tr>
                      <tr th:if="${classes == null or #lists.isEmpty(classes)}">
                        <td colspan="5" class="text-center text-muted py-3">Chưa có dữ liệu</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions & System Info -->
        <div class="row mb-4">
          <div class="col-md-8">
            <div class="card">
              <div class="card-header">
                <i class="fas fa-bolt me-2"></i>Thao tác nhanh
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <a th:href="@{/admin/faculties}" class="btn btn-outline-primary w-100 py-3">
                      <i class="fas fa-university fa-2x mb-2"></i>
                      <br>Quản lý Khoa
                    </a>
                  </div>
                  <div class="col-md-3 mb-3">
                    <a th:href="@{/admin/classes}" class="btn btn-outline-success w-100 py-3">
                      <i class="fas fa-chalkboard-teacher fa-2x mb-2"></i>
                      <br>Quản lý Lớp
                    </a>
                  </div>
                  <div class="col-md-3 mb-3">
                    <a th:href="@{/admin/users}" class="btn btn-outline-warning w-100 py-3">
                      <i class="fas fa-users fa-2x mb-2"></i>
                      <br>Quản lý Người dùng
                    </a>
                  </div>
                  <div class="col-md-3 mb-3">
                    <a th:href="@{/admin/activities}" class="btn btn-outline-info w-100 py-3">
                      <i class="fas fa-calendar-alt fa-2x mb-2"></i>
                      <br>Quản lý Hoạt động
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-header">
                <i class="fas fa-info-circle me-2"></i>Thông tin hệ thống
              </div>
              <div class="card-body">
                <ul class="list-group list-group-flush">
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Học kỳ hiện tại
                    <span class="badge bg-success" th:text="${currentSemester != null ? currentSemester.name : 'Chưa thiết lập'}">HK1</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Tổng hoạt động
                    <span class="badge bg-primary" th:text="${totalActivities != null ? totalActivities : 0}">0</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Tổng người dùng
                    <span class="badge bg-info" th:text="${totalUsers != null ? totalUsers : 0}">0</span>
                  </li>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    Phiên bản
                    <span class="badge bg-secondary">4.0</span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <div th:replace="~{admin/layout :: scripts}"></div>
  </body>
</html>
